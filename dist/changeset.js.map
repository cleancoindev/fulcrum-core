{"version":3,"sources":["../src/changeset.js"],"names":["Changeset","attributes","updateFromAPIAttributes","attrs","_id","id","_metadata","metadata","_minLat","min_lat","_maxLat","max_lat","_minLon","min_lon","_maxLon","max_lon","_numberOfChanges","number_of_changes","_closedAt","parseISOTimestamp","closed_at","_closedBy","closed_by","_closedByID","closed_by_id","_createdAt","created_at","_createdBy","created_by","_createdByID","created_by_id","_updatedAt","updated_at","_updatedBy","updated_by","_updatedByID","updated_by_id","_formID","form_id","toJSON","json","formatISOTimestamp","metadataDescription","import_id","application","parts","Object","keys","key","value","push","toString","JSON","stringify","length","join","application_version","browser","browser_version","platform","platform_version","device_manufacturer","device_model"],"mappings":"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","file":"changeset.js","sourcesContent":["import DateUtils from './utils/date-utils';\nimport { format } from 'util';\nimport compact from 'lodash.compact';\n\nexport default class Changeset {\n  constructor(attributes) {\n    this.updateFromAPIAttributes(attributes);\n  }\n\n  updateFromAPIAttributes(attrs) {\n    const attributes = attrs || {};\n\n    this._id = attributes.id;\n    this._metadata = attributes.metadata || {};\n    this._minLat = attributes.min_lat;\n    this._maxLat = attributes.max_lat;\n    this._minLon = attributes.min_lon;\n    this._maxLon = attributes.max_lon;\n    this._numberOfChanges = attributes.number_of_changes;\n    this._closedAt = DateUtils.parseISOTimestamp(attributes.closed_at);\n    this._closedBy = attributes.closed_by;\n    this._closedByID = attributes.closed_by_id;\n    this._createdAt = DateUtils.parseISOTimestamp(attributes.created_at);\n    this._createdBy = attributes.created_by;\n    this._createdByID = attributes.created_by_id;\n    this._updatedAt = DateUtils.parseISOTimestamp(attributes.updated_at);\n    this._updatedBy = attributes.updated_by;\n    this._updatedByID = attributes.updated_by_id;\n    this._formID = attributes.form_id;\n  }\n\n  toJSON() {\n    const json = {};\n\n    json.id = this._id;\n    json.metadata = this._metadata || {};\n\n    json.min_lat = this._minLat;\n    json.max_lat = this._maxLat;\n    json.min_lon = this._minLon;\n    json.max_lon = this._maxLon;\n\n    json.number_of_changes = this._numberOfChanges;\n\n    json.closed_at = DateUtils.formatISOTimestamp(this._closedAt);\n    json.closed_by = this._closedBy;\n    json.closed_by_id = this._closedByID;\n\n    json.created_at = DateUtils.formatISOTimestamp(this._createdAt);\n    json.created_by = this._createdBy;\n    json.created_by_id = this._createdByID;\n\n    json.updated_at = DateUtils.formatISOTimestamp(this._updatedAt);\n    json.updated_by = this._updatedBy;\n    json.updated_by_id = this._updatedByID;\n\n    json.form_id = this._formID;\n  }\n\n  get id() {\n    return this._id;\n  }\n\n  get isClosed() {\n    return this._closedAt != null;\n  }\n\n  get createdAt() {\n    return this._createdAt;\n  }\n\n  get updatedAt() {\n    return this._updatedAt;\n  }\n\n  get displayValue() {\n    return format('Submitted %s by %s from %s',\n                  this._createdAt,\n                  this._createdBy,\n                  this.metadataDescription);\n  }\n\n  get application() {\n    if (this._metadata.import_id) {\n      return 'Fulcrum Importer';\n    }\n\n    return this._metadata.application;\n  }\n\n  get metadataIndexText() {\n    if (!this._metadata) {\n      return null;\n    }\n\n    const parts = [];\n\n    for (const key of Object.keys(this._metadata)) {\n      const value = this._metadata[key];\n\n      if (typeof value === 'string') {\n        parts.push(value);\n      } else if (typeof value === 'number') {\n        parts.push(value.toString());\n      } else if (value != null) {\n        parts.push(JSON.stringify(value));\n      }\n    }\n\n    return parts.length ? parts.join(' ') : null;\n  }\n\n  get metadataDescription() {\n    const parts = [\n      compact([ this.application,\n                this._metadata.application_version ]).join(' '),\n\n      compact([ this._metadata.browser,\n                this._metadata.browser_version ]).join(' '),\n\n      compact([ this._metadata.platform,\n                this._metadata.platform_version ]).join(' '),\n\n      compact([ this._metadata.device_manufacturer,\n                this._metadata.device_model ]).join(' ')\n    ];\n\n    return compact(parts).join(' / ');\n  }\n}\n"]}