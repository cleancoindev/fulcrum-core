{"version":3,"sources":["../src/changeset.js"],"names":[],"mappings":"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","file":"changeset.js","sourcesContent":["import DateUtils from './utils/date-utils';\nimport { format } from 'util';\nimport compact from 'lodash.compact';\n\nexport default class Changeset {\n  constructor(attributes) {\n    this.updateFromAPIAttributes(attributes);\n  }\n\n  updateFromAPIAttributes(attrs) {\n    const attributes = attrs || {};\n\n    this._id = attributes.id;\n    this._metadata = attributes.metadata || {};\n    this._minLat = attributes.min_lat;\n    this._maxLat = attributes.max_lat;\n    this._minLon = attributes.min_lon;\n    this._maxLon = attributes.max_lon;\n    this._numberOfChanges = attributes.number_of_changes;\n    this._closedAt = DateUtils.parseISOTimestamp(attributes.closed_at);\n    this._closedBy = attributes.closed_by;\n    this._closedByID = attributes.closed_by_id;\n    this._createdAt = DateUtils.parseISOTimestamp(attributes.created_at);\n    this._createdBy = attributes.created_by;\n    this._createdByID = attributes.created_by_id;\n    this._updatedAt = DateUtils.parseISOTimestamp(attributes.updated_at);\n    this._updatedBy = attributes.updated_by;\n    this._updatedByID = attributes.updated_by_id;\n    this._formID = attributes.form_id;\n  }\n\n  toJSON() {\n    const json = {};\n\n    json.id = this._id;\n    json.metadata = this._metadata || {};\n\n    json.min_lat = this._minLat;\n    json.max_lat = this._maxLat;\n    json.min_lon = this._minLon;\n    json.max_lon = this._maxLon;\n\n    json.number_of_changes = this._numberOfChanges;\n\n    json.closed_at = DateUtils.formatISOTimestamp(this._closedAt);\n    json.closed_by = this._closedBy;\n    json.closed_by_id = this._closedByID;\n\n    json.created_at = DateUtils.formatISOTimestamp(this._createdAt);\n    json.created_by = this._createdBy;\n    json.created_by_id = this._createdByID;\n\n    json.updated_at = DateUtils.formatISOTimestamp(this._updatedAt);\n    json.updated_by = this._updatedBy;\n    json.updated_by_id = this._updatedByID;\n\n    json.form_id = this._formID;\n  }\n\n  get id() {\n    return this._id;\n  }\n\n  get isClosed() {\n    return this._closedAt != null;\n  }\n\n  get displayValue() {\n    return format('Submitted %s by %s from %s',\n                  this._createdAt,\n                  this._createdBy,\n                  this.metadataDescription);\n  }\n\n  get application() {\n    if (this._metadata.import_id) {\n      return 'Fulcrum Importer';\n    }\n\n    return this._metadata.application;\n  }\n\n  get metadataDescription() {\n    const parts = [\n      compact([ this.application,\n                this._metadata.application_version ]).join(' '),\n\n      compact([ this._metadata.browser,\n                this._metadata.browser_version ]).join(' '),\n\n      compact([ this._metadata.platform,\n                this._metadata.platform_version ]).join(' '),\n\n      compact([ this._metadata.device_manufacturer,\n                this._metadata.device_model ]).join(' ')\n    ];\n\n    return compact(parts).join(' / ');\n  }\n}\n"]}