{"version":3,"sources":["../../src/elements/choice-element.js"],"names":[],"mappings":"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","file":"choice-element.js","sourcesContent":["import Element from './element';\nimport Choice from './choice';\n\nexport default class ChoiceElement extends Element {\n  constructor(parent, attributes) {\n    super(parent, attributes);\n\n    this.multiple = !!attributes.multiple;\n    this.allowOther = !!attributes.allow_other;\n\n    this._choiceFilter = null;\n    this._overrideChoices = null;\n\n    this._choiceListID = attributes.choice_list_id;\n    this._choices = [];\n\n    // TODO(zhm) the loading needs to be re-worked to support choice lists\n    if (attributes.choices) {\n      for (const choice of attributes.choices) {\n        this._choices.push(new Choice(choice));\n      }\n    }\n  }\n\n  load(dataSource, callback) {\n    this._choicesByValue = null;\n\n    if (this._choiceListID) {\n      dataSource.getChoiceList(this._choiceListID, (err, choiceList) => {\n        // TODO(zhm) Some forms have orphaned choice lists (life sucks)\n        // Maybe we should add a parameter to the load() method to throw\n        // errors.\n        if (err) {\n          return callback(err);\n        }\n\n        this.choiceList = choiceList;\n        this._choices = this.choiceList.choices.slice();\n\n        return callback();\n      });\n    } else {\n      setImmediate(callback);\n    }\n  }\n\n  get isLengthValidationSupported() {\n    return this.multiple;\n  }\n\n  get choices() {\n    return this._overrideChoices ? this._overrideChoices : this.filteredChoices;\n  }\n\n  get choiceFilter() {\n    return this._choiceFilter;\n  }\n\n  set choiceFilter(choiceFilter) {\n    this._choiceFilter = choiceFilter;\n  }\n\n  get filteredChoices() {\n    const items = this._choices;\n\n    if (!this.choiceFilter) {\n      return items;\n    }\n\n    const filteredItems = [];\n\n    for (const item of items) {\n      for (const filter of this.choiceFilter) {\n        if (item.value.toLowerCase().indexOf(filter.toLowerCase()) !== -1) {\n          filteredItems.push(item);\n        }\n      }\n    }\n\n    return filteredItems;\n  }\n\n  get overrideChoices() {\n    return this._overrideChoices;\n  }\n\n  set overrideChoices(overrideChoices) {\n    this._choicesByValue = null;\n\n    if (!overrideChoices || overrideChoices.length < 1) {\n      this._overrideChoices = null;\n      return;\n    }\n\n    const choices = [];\n\n    for (const choiceAttributes of overrideChoices) {\n      const choice = new Choice(choiceAttributes);\n\n      choices.push(choice);\n    }\n\n    this._overrideChoices = choices;\n  }\n\n  get overrideValues() {\n    return Object.assign(Object.getOwnPropertyDescriptor(Element.prototype, 'overrideValues'), {\n      choiceFilter: this._choiceFilter,\n      overrideChoices: this._overrideChoices\n    });\n  }\n\n  resetOverrides() {\n    super.resetOverrides();\n\n    this._choiceFilter = null;\n    this._overrideChoices = null;\n  }\n\n  choiceByValue(value) {\n    if (!this._choicesByValue) {\n      this._choicesByValue = {};\n\n      for (const choice of this.choices) {\n        this._choicesByValue[choice.value] = choice;\n      }\n    }\n\n    return this._choicesByValue[value];\n  }\n}\n"]}