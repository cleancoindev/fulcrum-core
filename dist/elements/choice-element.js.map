{"version":3,"sources":["../../src/elements/choice-element.js"],"names":["ChoiceElement","parent","attributes","multiple","allowOther","allow_other","_choiceFilter","_overrideChoices","_choiceListID","choice_list_id","_choices","choices","choice","push","load","dataSource","callback","_choicesByValue","getChoiceList","err","choiceList","slice","setImmediate","resetOverrides","choiceByValue","value","filteredChoices","choiceFilter","items","filteredItems","matchedValues","item","filter","isMatch","toLowerCase","indexOf","overrideChoices","length","choiceAttributes","Object","assign","getOwnPropertyDescriptor","prototype","get","call"],"mappings":"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","file":"choice-element.js","sourcesContent":["import Element from './element';\nimport Choice from './choice';\n\nexport default class ChoiceElement extends Element {\n  constructor(parent, attributes) {\n    super(parent, attributes);\n\n    this.multiple = !!attributes.multiple;\n    this.allowOther = !!attributes.allow_other;\n\n    this._choiceFilter = null;\n    this._overrideChoices = null;\n\n    this._choiceListID = attributes.choice_list_id;\n    this._choices = [];\n\n    // TODO(zhm) the loading needs to be re-worked to support choice lists\n    if (attributes.choices) {\n      for (const choice of attributes.choices) {\n        this._choices.push(new Choice(choice));\n      }\n    }\n  }\n\n  load(dataSource, callback) {\n    this._choicesByValue = null;\n\n    if (this._choiceListID) {\n      dataSource.getChoiceList(this._choiceListID, (err, choiceList) => {\n        // TODO(zhm) Some forms have orphaned choice lists (life sucks)\n        // Maybe we should add a parameter to the load() method to throw\n        // errors.\n        if (err) {\n          return callback(err);\n        }\n\n        this.choiceList = choiceList;\n        this._choices = this.choiceList.choices.slice();\n\n        return callback();\n      });\n    } else {\n      setImmediate(callback);\n    }\n  }\n\n  get isLengthValidationSupported() {\n    return this.multiple;\n  }\n\n  get choices() {\n    return this._overrideChoices ? this._overrideChoices : this.filteredChoices;\n  }\n\n  get choiceFilter() {\n    return this._choiceFilter;\n  }\n\n  set choiceFilter(choiceFilter) {\n    this._choiceFilter = choiceFilter;\n  }\n\n  get filteredChoices() {\n    const items = this._choices;\n\n    if (!this.choiceFilter) {\n      return items;\n    }\n\n    const filteredItems = [];\n    const matchedValues = {};\n\n    for (const item of items) {\n      for (const filter of this.choiceFilter) {\n        const isMatch = item.value.toLowerCase().indexOf(filter.toLowerCase()) !== -1;\n\n        if (isMatch && !matchedValues[item.value]) {\n          filteredItems.push(item);\n          matchedValues[item.value] = item;\n        }\n      }\n    }\n\n    return filteredItems;\n  }\n\n  get overrideChoices() {\n    return this._overrideChoices;\n  }\n\n  set overrideChoices(overrideChoices) {\n    this._choicesByValue = null;\n\n    if (!overrideChoices || overrideChoices.length < 1) {\n      this._overrideChoices = null;\n      return;\n    }\n\n    const choices = [];\n\n    for (const choiceAttributes of overrideChoices) {\n      const choice = new Choice(choiceAttributes);\n\n      choices.push(choice);\n    }\n\n    this._overrideChoices = choices;\n  }\n\n  get overrideValues() {\n    return Object.assign(Object.getOwnPropertyDescriptor(Element.prototype, 'overrideValues').get.call(this), {\n      choiceFilter: this._choiceFilter,\n      overrideChoices: this._overrideChoices\n    });\n  }\n\n  resetOverrides() {\n    super.resetOverrides();\n\n    this._choiceFilter = null;\n    this._overrideChoices = null;\n  }\n\n  choiceByValue(value) {\n    if (!this._choicesByValue) {\n      this._choicesByValue = {};\n\n      for (const choice of this.choices) {\n        this._choicesByValue[choice.value] = choice;\n      }\n    }\n\n    return this._choicesByValue[value];\n  }\n}\n"]}