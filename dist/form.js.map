{"version":3,"sources":["../src/form.js"],"names":[],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;IAEqB;AACnB,WADmB,IACnB,CAAY,UAAZ,EAAwB;0BADL,MACK;;AACtB,SAAK,uBAAL,CAA6B,UAA7B,EADsB;GAAxB;;AADmB,iBAKnB,2DAAwB,YAAY;AAClC,iBAAa,cAAc,EAAd,CADqB;;AAGlC,SAAK,GAAL,GAAW,WAAW,EAAX,CAHuB;AAIlC,SAAK,KAAL,GAAa,WAAW,IAAX,CAJqB;AAKlC,SAAK,YAAL,GAAoB,WAAW,WAAX,CALc;AAMlC,SAAK,aAAL,GAAqB,WAAW,QAAX,CANa;AAOlC,SAAK,SAAL,GAAiB,IAAjB,CAPkC;AAQlC,SAAK,gBAAL,GAAwB,WAAW,YAAX,CARU;AASlC,SAAK,YAAL,GAAoB,IAApB,CATkC;AAUlC,SAAK,OAAL,GAAe,WAAW,MAAX,CAVmB;AAWlC,SAAK,iBAAL,GAAyB,CAAC,CAAC,WAAW,iBAAX,CAXO;AAYlC,SAAK,cAAL,GAAsB,WAAW,cAAX,CAZY;AAalC,SAAK,oBAAL,GAA4B,WAAW,gBAAX,CAbM;;AAelC,SAAK,eAAL,GAAuB,WAAW,eAAX,IAA8B,IAA9B,GAAqC,CAAC,CAAC,WAAW,eAAX,GAA6B,IAApE,CAfW;AAgBlC,SAAK,kBAAL,GAA0B,WAAW,kBAAX,IAAiC,IAAjC,GAAwC,CAAC,CAAC,WAAW,kBAAX,GAAgC,IAA1E,CAhBQ;;AAkBlC,QAAI,WAAW,gBAAX,IAA+B,WAAW,gBAAX,EAA6B;AAC9D,WAAK,mBAAL,GAA2B,WAAW,gBAAX,IAA+B,CAAC,WAAW,gBAAX,CAAhC,CADmC;KAAhE,MAEO;AACL,WAAK,mBAAL,GAA2B,EAA3B,CADK;KAFP;;;AAvBiB,iBAkCnB,qBAAK,YAAY,UAAU;AACzB,QAAI,KAAK,aAAL,EAAoB;AACtB,iBADsB;AAEtB,aAFsB;KAAxB;;AAKA,SAAK,aAAL,GAAqB,IAArB,CANyB;;AAQzB,QAAM,eAAe,EAAf,CARmB;;AAUzB,yBAAsB,KAAK,WAAL,8GAAtB,IAAwC;;;;;;;;;;;;UAA7B,eAA6B;;AACtC,UAAI,QAAQ,IAAR,EAAc;AAChB,qBAAa,IAAb,CAAkB,OAAlB,EADgB;OAAlB;KADF;;AAMA,oBAAM,IAAN,CAAW,YAAX,EAAyB,UAAC,OAAD,EAAU,EAAV,EAAiB;AACxC,cAAQ,IAAR,CAAa,UAAb,EAAyB,EAAzB,EADwC;KAAjB,EAEtB,QAFH,EAhByB;;;AAlCR,iBAuDnB,qCAAa,YAAY;AACvB,QAAM,SAAS,qBAAW,UAAX,EAAuB,IAAvB,CAAT,CADiB;;AAGvB,4BAAc,6BAAd,CAA4C,KAAK,QAAL,EACA,OAAO,UAAP,EACA,MAF5C,EAHuB;;AAOvB,WAAO,MAAP,CAPuB;;;AAvDN,iBAwEnB,mBAAI,KAAK;AACP,WAAO,KAAK,aAAL,CAAmB,GAAnB,CAAP,CADO;;;AAxEU,iBA4EnB,qBAAK,UAAU;AACb,WAAO,KAAK,kBAAL,CAAwB,QAAxB,CAAP,CADa;;;AA5EI,iBA4FnB,2BAAS;AACP,QAAM,OAAO,EAAP,CADC;;AAGP,SAAK,EAAL,GAAU,KAAK,EAAL,IAAW,IAAX,CAHH;AAIP,SAAK,IAAL,GAAY,KAAK,IAAL,IAAa,IAAb,CAJL;AAKP,SAAK,WAAL,GAAmB,KAAK,WAAL,IAAoB,IAApB,CALZ;AAMP,SAAK,MAAL,GAAc,KAAK,MAAL,IAAe,IAAf,CANP;AAOP,SAAK,QAAL,GAAgB,KAAK,KAAL,CAAW,KAAK,SAAL,CAAe,KAAK,aAAL,CAA1B,CAAhB,CAPO;AAQP,SAAK,kBAAL,GAA0B,KAAK,mBAAL,CARnB;AASP,SAAK,eAAL,GAAuB,KAAK,gBAAL,CAThB;AAUP,SAAK,iBAAL,GAAyB,KAAK,kBAAL,CAVlB;AAWP,SAAK,cAAL,GAAsB,KAAK,cAAL,CAXf;AAYP,SAAK,gBAAL,GAAwB,KAAK,cAAL,CAZjB;AAaP,SAAK,gBAAL,GAAwB,KAAK,eAAL,CAbjB;;AAeP,WAAO,IAAP,CAfO;;;eA5FU;;wBA8BV;AACP,aAAO,KAAK,GAAL,CADA;;;;wBAmCS;AAChB,UAAI,CAAC,KAAK,YAAL,EAAmB;AACtB,aAAK,YAAL,GAAoB,4BAAkB,IAAlB,EAAwB,KAAK,gBAAL,CAA5C,CADsB;OAAxB;AAGA,aAAO,KAAK,YAAL,CAJS;;;;wBAeI;AACpB,aAAO,KAAP,CADoB;;;;wBAIC;AACrB,aAAO,KAAK,eAAL,CADc;;;;wBAIG;AACxB,aAAO,KAAK,kBAAL,CADiB;;;;wBAsBF;AACtB,aAAO,KAAK,cAAL,IAAuB,KAAK,cAAL,CAAoB,MAApB,CADR;;;;wBAIC;AACvB,aAAO,KAAK,iBAAL,CADgB;;;;wBAId;AACT,aAAO,KAAK,KAAL,CADE;;;;wBAIO;AAChB,aAAO,KAAK,YAAL,CADS;;;;wBAIL;AACX,aAAO,KAAK,OAAL,CADI;;;;wBAIQ;AACnB,aAAO,KAAK,mBAAL,IAA4B,EAA5B,CADY;;;;wBAIC;AACpB,aAAO,KAAK,oBAAL,IAA6B,EAA7B,CADa;;;;wBAID;AACnB,aAAO,KAAK,eAAL,CAAqB,MAArB,GAA8B,KAAK,eAAL,CAAqB,CAArB,CAA9B,GAAwD,IAAxD,CADY;;;;SA1IF;;;;;;AA+IrB,wBAAc,WAAd,CAA0B,IAA1B","file":"form.js","sourcesContent":["import ChildElements from './elements/child-elements';\nimport StatusElement from './elements/status-element';\nimport DefaultValues from './values/default-values';\nimport Record from './record';\nimport async from 'async';\n\nexport default class Form {\n  constructor(attributes) {\n    this.updateFromAPIAttributes(attributes);\n  }\n\n  updateFromAPIAttributes(attributes) {\n    attributes = attributes || {};\n\n    this._id = attributes.id;\n    this._name = attributes.name;\n    this._description = attributes.description;\n    this._elementsJSON = attributes.elements;\n    this._elements = null;\n    this._statusFieldJSON = attributes.status_field;\n    this._statusField = null;\n    this._script = attributes.script;\n    this._geometryRequired = !!attributes.geometry_required;\n    this._geometryTypes = attributes.geometry_types;\n    this._reportTemplatesJSON = attributes.report_templates;\n\n    this._projectEnabled = attributes.project_enabled != null ? !!attributes.project_enabled : true;\n    this._assignmentEnabled = attributes.assignment_enabled != null ? !!attributes.assignment_enabled : true;\n\n    if (attributes.title_field_keys || attributes.record_title_key) {\n      this._titleFieldKeysJSON = attributes.title_field_keys || [attributes.record_title_key];\n    } else {\n      this._titleFieldKeysJSON = [];\n    }\n  }\n\n  get id() {\n    return this._id;\n  }\n\n  load(dataSource, callback) {\n    if (this._schemaLoaded) {\n      callback();\n      return;\n    }\n\n    this._schemaLoaded = true;\n\n    const loadElements = [];\n\n    for (const element of this.allElements) {\n      if (element.load) {\n        loadElements.push(element);\n      }\n    }\n\n    async.each(loadElements, (element, cb) => {\n      element.load(dataSource, cb);\n    }, callback);\n  }\n\n  createRecord(attributes) {\n    const record = new Record(attributes, this);\n\n    DefaultValues.applyDefaultValuesForElements(this.elements,\n                                                record.formValues,\n                                                record);\n\n    return record;\n  }\n\n  get statusField() {\n    if (!this._statusField) {\n      this._statusField = new StatusElement(this, this._statusFieldJSON);\n    }\n    return this._statusField;\n  }\n\n  get(key) {\n    return this.elementsByKey[key];\n  }\n\n  find(dataName) {\n    return this.elementsByDataName[dataName];\n  }\n\n  get hasHiddenParent() {\n    return false;\n  }\n\n  get isProjectEnabled() {\n    return this._projectEnabled;\n  }\n\n  get isAssignmentEnabled() {\n    return this._assignmentEnabled;\n  }\n\n  toJSON() {\n    const json = {};\n\n    json.id = this.id || null;\n    json.name = this.name || null;\n    json.description = this.description || null;\n    json.script = this.script || null;\n    json.elements = JSON.parse(JSON.stringify(this._elementsJSON));\n    json.assignment_enabled = this.isAssignmentEnabled;\n    json.project_enabled = this.isProjectEnabled;\n    json.geometry_required = this.isGeometryRequired;\n    json.geometry_types = this._geometryTypes;\n    json.title_field_keys = this.titleFieldKeys;\n    json.report_templates = this.reportTemplates;\n\n    return json;\n  }\n\n  get isGeometryEnabled() {\n    return this._geometryTypes && this._geometryTypes.length;\n  }\n\n  get isGeometryRequired() {\n    return this._geometryRequired;\n  }\n\n  get name() {\n    return this._name;\n  }\n\n  get description() {\n    return this._description;\n  }\n\n  get script() {\n    return this._script;\n  }\n\n  get titleFieldKeys() {\n    return this._titleFieldKeysJSON || [];\n  }\n\n  get reportTemplates() {\n    return this._reportTemplatesJSON || [];\n  }\n\n  get reportTemplate() {\n    return this.reportTemplates.length ? this.reportTemplates[0] : null;\n  }\n}\n\nChildElements.includeInto(Form);\n"]}