{"version":3,"sources":["../../src/values/classification-value.js"],"names":[],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;;;;;;;;;AAEA,IAAM,mBAAmB,KAAnB;;AAEN,IAAM,kBAAkB,GAAlB;;IAEe;;;AACnB,WADmB,mBACnB,CAAY,OAAZ,EAAqB,UAArB,EAAiC;0BADd,qBACc;;iDAC/B,sBAAM,OAAN,EAAe,UAAf,GAD+B;;AAG/B,UAAK,aAAL,GAAqB,EAArB,CAH+B;AAI/B,UAAK,YAAL,GAAoB,EAApB,CAJ+B;;AAM/B,QAAI,UAAJ,EAAgB;AACd,UAAI,WAAW,aAAX,EAA0B;AAC5B,6BAAmB,WAAW,aAAX,8GAAnB,IAA6C;;;;;;;;;;;;cAApC,cAAoC;;AAC3C,cAAI,oBAAU,SAAV,CAAoB,MAApB,CAAJ,EAAiC;AAC/B,kBAAK,aAAL,CAAmB,IAAnB,CAAwB,MAAxB,EAD+B;WAAjC;SADF;OADF;;AAQA,UAAI,WAAW,YAAX,EAAyB;AAC3B,8BAAmB,WAAW,YAAX,qHAAnB,IAA4C;;;;;;;;;;;;cAAnC,gBAAmC;;AAC1C,cAAI,oBAAU,SAAV,CAAoB,OAApB,CAAJ,EAAiC;AAC/B,kBAAK,YAAL,CAAkB,IAAlB,CAAuB,OAAvB,EAD+B;WAAjC;SADF;OADF;KATF;iBAN+B;GAAjC;;AADmB,gCAsCnB,2BAAQ,OAAO;AACb,QAAM,iBAAiB,KAAK,sBAAL,CADV;;AAGb,QAAM,eAAe,iBAAiB,eAAe,MAAf,EAAjB,GAA2C,IAA3C,CAHR;;AAKb,QAAM,UAAU,MAAV,CALO;;AAOb,QAAM,QAAQ,MAAM,OAAN,CAAc,OAAd,EAAuB,MAAvB,EAA+B,KAA/B,CAAqC,GAArC,EAA0C,GAA1C,CAA8C;aAAQ,KAAK,OAAL,CAAa,OAAb,EAAsB,GAAtB;KAAR,CAAtD,CAPO;;AASb,QAAI,gBAAgB,KAAhB,CATS;;AAWb,QAAI,YAAY,CAAZ,CAXS;;AAab,0BAAmB,0HAAnB,IAA0B;;;;;;;;;;;;UAAf,aAAe;;AACxB,UAAI,QAAQ,IAAR,IAAgB,YAAhB,IAAgC,YAAY,aAAa,MAAb,IAC5C,aAAa,SAAb,EAAwB,WAAxB,OAA0C,KAAK,OAAL,CAAa,OAAb,EAAsB,GAAtB,EAA2B,WAA3B,EAA1C,EAAoF;AACtF,wBAAgB,IAAhB,CADsF;OADxF,MAGO;AACL,wBAAgB,KAAhB,CADK;OAHP;;AAOA,QAAE,SAAF,CARwB;KAA1B;;AAWA,WAAO,aAAP,CAxBa;;;AAtCI,gCAiEnB,6BAAS,OAAO;AACd,WAAO,KAAK,OAAL,CAAa,KAAb,CAAP,CADc;;;AAjEG,gCAqEnB,iCAAW,OAAO;AAChB,WAAO,KAAK,QAAL,CAAc,KAAd,CAAP,CADgB;;;AArEC,gCAyHnB,2BAAS;AACP,QAAI,KAAK,OAAL,EAAc;AAChB,aAAO,IAAP,CADgB;KAAlB;;AAIA,QAAM,eAAe,KAAK,aAAL,CAAmB,KAAnB,EAAf,CALC;AAMP,QAAM,cAAc,KAAK,YAAL,CAAkB,KAAlB,EAAd,CANC;;AAQP,WAAO;AACL,qBAAe,YAAf;AACA,oBAAc,WAAd;KAFF,CARO;;;AAzHU,gCAuMnB,+DAA0B,gBAAgB,YAAY;AACpD,QAAI,kDAAJ,EAA8C;AAC5C,WAAK,6BAAL,CAAmC,eAAe,MAAf,EAAnC,EAA4D,UAA5D,EAD4C;KAA9C,MAEO;AACL,WAAK,6BAAL,CAAmC,IAAnC,EAAyC,UAAzC,EADK;KAFP;;;AAxMiB,gCA+MnB,uEAA8B,sBAAsB,YAAY;AAC9D,QAAI,wBAAwB,qBAAqB,MAArB,EAA6B;AACvD,WAAK,aAAL,GAAqB,oBAArB,CADuD;KAAzD,MAEO;AACL,WAAK,aAAL,GAAqB,EAArB,CADK;KAFP;;AAMA,QAAI,UAAJ,EAAgB;AACd,WAAK,YAAL,GAAoB,CAAE,WAAW,QAAX,EAAF,CAApB,CADc;KAAhB,MAEO;AACL,WAAK,WAAL,GAAmB,EAAnB,CADK;KAFP;;;eAtNiB;;wBA0BL;AACZ,UAAI,KAAK,aAAL,CAAmB,MAAnB,EAA2B;AAC7B,eAAO,KAAP,CAD6B;OAA/B;;AAIA,UAAI,KAAK,YAAL,CAAkB,MAAlB,EAA0B;AAC5B,eAAO,KAAP,CAD4B;OAA9B;;AAIA,aAAO,IAAP,CATY;;;;wBA+CK;AACjB,UAAM,SAAS,EAAT,CADW;;AAGjB,UAAM,iBAAiB,KAAK,sBAAL,CAHN;;AAKjB,UAAI,cAAJ,EAAoB;AAClB,8BAAiB,eAAe,QAAf,qHAAjB,IAA0C;;;;;;;;;;;;cAAjC,aAAiC;;AACxC,cAAI,KAAK,KAAL,EAAY;AACd,mBAAO,IAAP,CAAY,KAAK,KAAL,CAAZ,CADc;WAAhB;SADF;OADF;;AAQA,UAAI,KAAK,aAAL,EAAoB;AACtB,eAAO,IAAP,CAAY,KAAK,UAAL,CAAZ,CADsB;OAAxB;;AAIA,aAAO,OAAO,IAAP,CAAY,gBAAZ,CAAP,CAjBiB;;;;wBAoBG;AACpB,UAAM,SAAS,EAAT,CADc;;AAGpB,UAAM,iBAAiB,KAAK,sBAAL,CAHH;;AAKpB,UAAI,cAAJ,EAAoB;AAClB,8BAAiB,eAAe,QAAf,qHAAjB,IAA0C;;;;;;;;;;;;cAAjC,aAAiC;;AACxC,cAAI,KAAK,KAAL,EAAY;AACd,mBAAO,IAAP,CAAY,KAAK,KAAL,CAAZ,CADc;WAAhB;;AAIA,cAAI,KAAK,KAAL,EAAY;AACd,mBAAO,IAAP,CAAY,KAAK,KAAL,CAAZ,CADc;WAAhB;SALF;OADF;;AAYA,UAAI,KAAK,aAAL,EAAoB;AACtB,eAAO,IAAP,CAAY,KAAK,UAAL,CAAZ,CADsB;OAAxB;;AAIA,aAAO,OAAO,IAAP,CAAY,eAAZ,CAAP,CArBoB;;;;wBAwBT;AACX,aAAO,KAAK,aAAL,CAAmB,MAAnB,GAA4B,KAAK,YAAL,CAAkB,MAAlB,CADxB;;;;wBAkBK;AAChB,UAAM,YAAY,EAAZ,CADU;;AAGhB,4BAAkB,KAAK,aAAL,qHAAlB,IAAsC;;;;;;;;;;;;YAA7B,cAA6B;;AACpC,kBAAU,IAAV,CAAe,KAAf,EADoC;OAAtC;;AAIA,4BAAkB,KAAK,YAAL,qHAAlB,IAAqC;;;;;;;;;;;;YAA5B,eAA4B;;AACnC,kBAAU,IAAV,CAAe,MAAf,EADmC;OAArC;;AAIA,UAAI,UAAU,MAAV,KAAqB,CAArB,EAAwB;AAC1B,eAAO,IAAP,CAD0B;OAA5B;;AAIA,aAAO,SAAP,CAfgB;;;;wBAkBG;AACnB,aAAO,IAAP,CADmB;;;;wBAID;AAClB,aAAO,KAAK,YAAL,CAAkB,MAAlB,KAA6B,CAA7B,CADW;;;;wBAIH;AACf,UAAI,CAAC,KAAK,aAAL,EAAoB;AACvB,eAAO,IAAP,CADuB;OAAzB;;AAIA,aAAO,KAAK,YAAL,CAAkB,CAAlB,CAAP,CALe;;sBAQF,OAAO;AACpB,UAAI,SAAS,MAAM,MAAN,EAAc;AACzB,aAAK,YAAL,GAAoB,CAAE,KAAF,CAApB,CADyB;OAA3B,MAEO;AACL,aAAK,YAAL,GAAoB,EAApB,CADK;OAFP;;;;wBAO2B;AAC3B,UAAI,SAAS,IAAT,CADuB;;AAG3B,UAAI,KAAK,aAAL,CAAmB,MAAnB,KAA8B,CAA9B,EAAiC;AACnC,eAAO,IAAP,CADmC;OAArC;;AAIA,UAAI,yBAAyB,KAAK,OAAL,CAAa,mBAAb,CAPF;;AAS3B,4BAAgC,KAAK,aAAL,qHAAhC,IAAoD;;;;;;;;;;;;YAA3C,4BAA2C;;AAClD,8BAA2B,2IAA3B,IAAmD;;;;;;;;;;;;cAA1C,uBAA0C;;AACjD,cAAI,eAAe,KAAf,KAAyB,mBAAzB,EAA8C;AAChD,qBAAS,cAAT,CADgD;AAEhD,qCAAyB,eAAe,KAAf,CAFuB;AAGhD,kBAHgD;WAAlD;SADF;OADF;;AAUA,aAAO,MAAP,CAnB2B;;;;SAjLV","file":"classification-value.js","sourcesContent":["import FormValue from './form-value';\nimport TextUtils from '../utils/text-utils';\nimport Classification from '../elements/classification';\n\nconst DisplaySeparator = ' â–¸ ';\n\nconst SearchSeparator = ' ';\n\nexport default class ClassificationValue extends FormValue {\n  constructor(element, attributes) {\n    super(element, attributes);\n\n    this._choiceValues = [];\n    this._otherValues = [];\n\n    if (attributes) {\n      if (attributes.choice_values) {\n        for (let choice of attributes.choice_values) {\n          if (TextUtils.isPresent(choice)) {\n            this._choiceValues.push(choice);\n          }\n        }\n      }\n\n      if (attributes.other_values) {\n        for (let choice of attributes.other_values) {\n          if (TextUtils.isPresent(choice)) {\n            this._otherValues.push(choice);\n          }\n        }\n      }\n    }\n  }\n\n  get isEmpty() {\n    if (this._choiceValues.length) {\n      return false;\n    }\n\n    if (this._otherValues.length) {\n      return false;\n    }\n\n    return true;\n  }\n\n  isEqual(value) {\n    const classification = this.selectedClassification;\n\n    const choiceValues = classification ? classification.toJSON() : null;\n\n    const ESCAPED = /\\\\,/g;\n\n    const parts = value.replace(ESCAPED, '\\t\\t').split(',').map(part => part.replace(/\\t\\t/g, ','));\n\n    let allMatchSoFar = false;\n\n    let partIndex = 0;\n\n    for (const part of parts) {\n      if (part != null && choiceValues && partIndex < choiceValues.length &&\n          choiceValues[partIndex].toLowerCase() === part.replace(ESCAPED, ',').toLowerCase()) {\n        allMatchSoFar = true;\n      } else {\n        allMatchSoFar = false;\n      }\n\n      ++partIndex;\n    }\n\n    return allMatchSoFar;\n  }\n\n  contains(value) {\n    return this.isEqual(value);\n  }\n\n  startsWith(value) {\n    return this.contains(value);\n  }\n\n  get displayValue() {\n    const values = [];\n\n    const classification = this.selectedClassification;\n\n    if (classification) {\n      for (let item of classification.exploded) {\n        if (item.label) {\n          values.push(item.label);\n        }\n      }\n    }\n\n    if (this.hasOtherValue) {\n      values.push(this.otherValue);\n    }\n\n    return values.join(DisplaySeparator);\n  }\n\n  get searchableValue() {\n    const values = [];\n\n    const classification = this.selectedClassification;\n\n    if (classification) {\n      for (let item of classification.exploded) {\n        if (item.label) {\n          values.push(item.label);\n        }\n\n        if (item.value) {\n          values.push(item.value);\n        }\n      }\n    }\n\n    if (this.hasOtherValue) {\n      values.push(this.otherValue);\n    }\n\n    return values.join(SearchSeparator);\n  }\n\n  get length() {\n    return this._choiceValues.length + this._otherValues.length;\n  }\n\n  toJSON() {\n    if (this.isEmpty) {\n      return null;\n    }\n\n    const choiceValues = this._choiceValues.slice();\n    const otherValues = this._otherValues.slice();\n\n    return {\n      choice_values: choiceValues,\n      other_values: otherValues\n    };\n  }\n\n  get columnValue() {\n    const allValues = [];\n\n    for (let value of this._choiceValues) {\n      allValues.push(value);\n    }\n\n    for (let value of this._otherValues) {\n      allValues.push(value);\n    }\n\n    if (allValues.length === 0) {\n      return null;\n    }\n\n    return allValues;\n  }\n\n  get multipleValues() {\n    return null;\n  }\n\n  get hasOtherValue() {\n    return this._otherValues.length !== 0;\n  }\n\n  get otherValue() {\n    if (!this.hasOtherValue) {\n      return null;\n    }\n\n    return this._otherValues[0];\n  }\n\n  set otherValue(value) {\n    if (value && value.length) {\n      this._otherValues = [ value ];\n    } else {\n      this._otherValues = [];\n    }\n  }\n\n  get selectedClassification() {\n    let result = null;\n\n    if (this._choiceValues.length === 0) {\n      return null;\n    }\n\n    let currentClassifications = this.element.classificationItems;\n\n    for (let classificationValue of this._choiceValues) {\n      for (let classification of currentClassifications) {\n        if (classification.value === classificationValue) {\n          result = classification;\n          currentClassifications = classification.items;\n          break;\n        }\n      }\n    }\n\n    return result;\n  }\n\n  setSelectedClassification(classification, otherValue) {\n    if (classification instanceof Classification) {\n      this.setSelectedClassificationJSON(classification.toJSON(), otherValue);\n    } else {\n      this.setSelectedClassificationJSON(null, otherValue);\n    }\n  }\n\n  setSelectedClassificationJSON(classificationAsJSON, otherValue) {\n    if (classificationAsJSON && classificationAsJSON.length) {\n      this._choiceValues = classificationAsJSON;\n    } else {\n      this._choiceValues = [];\n    }\n\n    if (otherValue) {\n      this._otherValues = [ otherValue.toString() ];\n    } else {\n      this._otherVaues = [];\n    }\n  }\n}\n"]}