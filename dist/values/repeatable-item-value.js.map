{"version":3,"sources":["../../src/values/repeatable-item-value.js"],"names":[],"mappings":"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","file":"repeatable-item-value.js","sourcesContent":["import Feature from '../feature';\nimport FormValues from './form-values';\nimport DateUtils from '../utils/date-utils';\nimport TextUtils from '../utils/text-utils';\n\nexport default class RepeatableItemValue extends Feature {\n  constructor(element, item, index) {\n    super();\n\n    this.index = index;\n\n    this._element = element;\n    this._id = item.id;\n    this._createdAt = DateUtils.parseTimestamp(item.created_at);\n    this._updatedAt = DateUtils.parseTimestamp(item.updated_at);\n    this._formValuesJSON = item.form_values;\n\n    const geometry = item.geometry;\n\n    if (geometry != null && geometry.type === 'Point') {\n      this._latitude = geometry.coordinates[1];\n      this._longitude = geometry.coordinates[0];\n    }\n  }\n\n  get identifier() {\n    return this._id;\n  }\n\n  get createdAt() {\n    return this._createdAt;\n  }\n\n  get updatedAt() {\n    return this._updatedAt;\n  }\n\n  get formValues() {\n    if (!this._formValues) {\n      this._formValues = new FormValues(this._element, this._formValuesJSON);\n    }\n\n    return this._formValues;\n  }\n\n  get hasCoordinate() {\n    return this._latitude != null && this._longitude != null;\n  }\n\n  toJSON() {\n    const json = {};\n\n    json.id = this.identifier;\n    json.created_at = DateUtils.formatTimestamp(this.createdAt);\n    json.updated_at = DateUtils.formatTimestamp(this.updatedAt);\n    json.form_values = this.formValues.toJSON();\n    json.geometry = this.geometryAsGeoJSON();\n\n    return json;\n  }\n\n  updateTimestamps() {\n    const now = new Date();\n\n    if (!this._createdAt) {\n      this._createdAt = now;\n    }\n\n    this._updatedAt = now;\n  }\n\n  get isGeometryEnabled() {\n    return this._element.isGeometryEnabled;\n  }\n\n  get latitude() {\n    return this._latitude;\n  }\n\n  get longitude() {\n    return this._longitude;\n  }\n\n  get displayValue() {\n    const titleFieldKeys = this._element.titleFieldKeys;\n    const titles = [];\n\n    for (let fieldKey of titleFieldKeys) {\n      const formValue = this.formValues.get(fieldKey);\n\n      if (formValue) {\n        const displayValue = formValue.displayValue;\n\n        if (TextUtils.isPresent(displayValue)) {\n          titles.push(displayValue);\n        }\n      }\n    }\n\n    return titles.join(', ');\n  }\n\n  geometryAsGeoJSON() {\n    if (!this.hasCoordinate) {\n      return null;\n    }\n\n    return {\n      type: 'Point',\n      coordinates: [this._longitude, this._latitude]\n    };\n  }\n}\n"]}