{"version":3,"sources":["../../src/values/repeatable-item-value.js"],"names":[],"mappings":"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","file":"repeatable-item-value.js","sourcesContent":["import Feature from '../feature';\nimport FormValues from './form-values';\nimport DateUtils from '../utils/date-utils';\nimport TextUtils from '../utils/text-utils';\nimport loadObject from '../load-object';\n\nexport default class RepeatableItemValue extends Feature {\n  constructor(element, item, index) {\n    super();\n\n    this.index = index;\n\n    this._element = element;\n    this._id = item.id;\n    this._createdAt = DateUtils.parseEpochTimestamp(item.created_at);\n    this._updatedAt = DateUtils.parseEpochTimestamp(item.updated_at);\n    this._formValuesJSON = item.form_values;\n    this._version = item.version || 1;\n    this._changesetID = item.changeset_id;\n    this._createdByID = item.created_by_id;\n    this._updatedByID = item.updated_by_id;\n\n    const geometry = item.geometry;\n\n    if (geometry != null &&\n        geometry.type === 'Point' &&\n        geometry.coordinates &&\n        geometry.coordinates.length > 1) {\n      this._latitude = geometry.coordinates[1];\n      this._longitude = geometry.coordinates[0];\n    }\n\n    this._createdDuration = item.created_duration || null;\n    this._updatedDuration = item.updated_duration || null;\n    this._editedDuration = item.edited_duration || null;\n\n    const createdLocation = item.created_location;\n\n    this._createdLatitude = null;\n    this._createdLongitude = null;\n    this._createdAltitude = null;\n    this._createdAccuracy = null;\n\n    if (createdLocation) {\n      this._createdLatitude = createdLocation.latitude;\n      this._createdLongitude = createdLocation.longitude;\n      this._createdAltitude = createdLocation.altitude;\n      this._createdAccuracy = createdLocation.horizontal_accuracy;\n    }\n\n    const updatedLocation = item.updated_location;\n\n    this._updatedLatitude = null;\n    this._updatedLongitude = null;\n    this._updatedAltitude = null;\n    this._updatedAccuracy = null;\n\n    if (updatedLocation) {\n      this._updatedLatitude = updatedLocation.latitude;\n      this._updatedLongitude = updatedLocation.longitude;\n      this._updatedAltitude = updatedLocation.altitude;\n      this._updatedAccuracy = updatedLocation.horizontal_accuracy;\n    }\n  }\n\n  get element() {\n    return this._element;\n  }\n\n  get id() {\n    return this._id;\n  }\n\n  get createdAt() {\n    return this._createdAt;\n  }\n\n  get version() {\n    return this._version;\n  }\n\n  set createdAt(createdAt) {\n    if (createdAt != null && !(createdAt instanceof Date)) {\n      throw new TypeError('createdAt must be a Date');\n    }\n\n    this._createdAt = createdAt;\n  }\n\n  get updatedAt() {\n    return this._updatedAt;\n  }\n\n  set updatedAt(updatedAt) {\n    if (updatedAt != null && !(updatedAt instanceof Date)) {\n      throw new TypeError('updatedAt must be a Date');\n    }\n\n    this._updatedAt = updatedAt;\n  }\n\n  get formValues() {\n    if (!this._formValues) {\n      this._formValues = new FormValues(this._element, this._formValuesJSON);\n    }\n\n    return this._formValues;\n  }\n\n  get hasCoordinate() {\n    return this._latitude != null && this._longitude != null;\n  }\n\n  toJSON() {\n    const json = {};\n\n    json.id = this.id;\n    json.created_at = DateUtils.formatEpochTimestamp(this.createdAt);\n    json.updated_at = DateUtils.formatEpochTimestamp(this.updatedAt);\n    json.form_values = this.formValues.toJSON();\n    json.geometry = this.geometryAsGeoJSON;\n    json.created_location = this.createdLocation;\n    json.updated_location = this.updatedLocation;\n    json.created_duration = this.createdDuration;\n    json.updated_duration = this.updatedDuration;\n    json.edited_duration = this.editedDuration;\n\n    return json;\n  }\n\n  updateTimestamps() {\n    const now = new Date();\n\n    if (!this._createdAt) {\n      this._createdAt = now;\n    }\n\n    this._updatedAt = now;\n  }\n\n  get isGeometryEnabled() {\n    return this._element.isGeometryEnabled;\n  }\n\n  get displayValue() {\n    const titleFieldKeys = this._element.titleFieldKeys;\n    const titles = [];\n\n    for (const fieldKey of titleFieldKeys) {\n      const formValue = this.formValues.get(fieldKey);\n\n      if (formValue) {\n        const displayValue = formValue.displayValue;\n\n        if (TextUtils.isPresent(displayValue)) {\n          titles.push(displayValue);\n        }\n      }\n    }\n\n    return titles.join(', ');\n  }\n\n  get searchableValue() {\n    return this.formValues.searchableValue;\n  }\n\n  get geometryAsGeoJSON() {\n    if (!this.hasCoordinate) {\n      return null;\n    }\n\n    return {\n      type: 'Point',\n      coordinates: [ this._longitude, this._latitude ]\n    };\n  }\n\n  get latitude() {\n    return this._latitude;\n  }\n\n  set latitude(latitude) {\n    this._latitude = latitude;\n  }\n\n  get longitude() {\n    return this._longitude;\n  }\n\n  set longitude(longitude) {\n    this._longitude = longitude;\n  }\n\n  get changesetID() {\n    return this._changesetID;\n  }\n\n  get createdByID() {\n    return this._createdByID;\n  }\n\n  get updatedByID() {\n    return this._updatedByID;\n  }\n\n  loadChangeset(dataSource, callback) {\n    return loadObject(this, dataSource, 'changeset', 'getChangeset', callback);\n  }\n\n  loadCreatedBy(dataSource, callback) {\n    return loadObject(this, dataSource, 'updatedBy', 'getUser', callback);\n  }\n\n  loadUpdatedBy(dataSource, callback) {\n    return loadObject(this, dataSource, 'createdBy', 'getUser', callback);\n  }\n\n  get changeset() {\n    return this._changeset;\n  }\n\n  get updatedBy() {\n    return this._updatedBy;\n  }\n\n  get createdBy() {\n    return this._createdBy;\n  }\n\n  get createdDuration() {\n    return this._createdDuration;\n  }\n\n  set createdDuration(value) {\n    this._createdDuration = (value != null ? +value : null);\n  }\n\n  get updatedDuration() {\n    return this._updatedDuration;\n  }\n\n  set updatedDuration(value) {\n    this._updatedDuration = (value != null ? +value : null);\n  }\n\n  get editedDuration() {\n    return this._editedDuration;\n  }\n\n  set editedDuration(value) {\n    this._editedDuration = (value != null ? +value : null);\n  }\n\n  get createdLatitude() {\n    return this._createdLatitude;\n  }\n\n  get createdLongitude() {\n    return this._createdLongitude;\n  }\n\n  get createdAltitude() {\n    return this._createdAltitude;\n  }\n\n  get createdAccuracy() {\n    return this._createdAccuracy;\n  }\n\n  set createdLatitude(value) {\n    this._createdLatitude = (value != null ? +value : null);\n  }\n\n  set createdLongitude(value) {\n    this._createdLongitude = (value != null ? +value : null);\n  }\n\n  set createdAltitude(value) {\n    this._createdAltitude = (value != null ? +value : null);\n  }\n\n  set createdAccuracy(value) {\n    this._createdAccuracy = (value != null ? +value : null);\n  }\n\n  get updatedLatitude() {\n    return this._updatedLatitude;\n  }\n\n  get updatedLongitude() {\n    return this._updatedLongitude;\n  }\n\n  get updatedAltitude() {\n    return this._updatedAltitude;\n  }\n\n  get updatedAccuracy() {\n    return this._updatedAccuracy;\n  }\n\n  set updatedLatitude(value) {\n    this._updatedLatitude = (value != null ? +value : null);\n  }\n\n  set updatedLongitude(value) {\n    this._updatedLongitude = (value != null ? +value : null);\n  }\n\n  set updatedAltitude(value) {\n    this._updatedAltitude = (value != null ? +value : null);\n  }\n\n  set updatedAccuracy(value) {\n    this._updatedAccuracy = (value != null ? +value : null);\n  }\n\n  get hasCreatedCoordinate() {\n    return this.createdLatitude != null && this.createdLongitude != null;\n  }\n\n  get hasUpdatedCoordinate() {\n    return this.updatedLatitude != null && this.updatedLongitude != null;\n  }\n\n  get createdLocation() {\n    if (this.hasCreatedCoordinate) {\n      return {\n        latitude: this.createdLatitude,\n        longitude: this.createdLongitude,\n        altitude: this.createdAltitude,\n        horizontal_accuracy: this.createdAccuracy\n      };\n    }\n\n    return null;\n  }\n\n  get updatedLocation() {\n    if (this.hasUpdatedCoordinate) {\n      return {\n        latitude: this.updatedLatitude,\n        longitude: this.updatedLongitude,\n        altitude: this.updatedAltitude,\n        horizontal_accuracy: this.updatedAccuracy\n      };\n    }\n\n    return null;\n  }\n}\n"]}